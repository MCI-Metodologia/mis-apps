<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cora√ß√£o Peludinho - Luto por Animais</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; font-size: 20px; background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); min-height: 100vh; padding: 15px; }
        .lock-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); display: flex; justify-content: center; align-items: center; z-index: 10000; padding: 20px; }
        .lock-modal.hidden { display: none; }
        .lock-content { background: white; border-radius: 25px; padding: 40px 30px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; }
        .lock-logo { font-size: 4em; margin-bottom: 20px; }
        .lock-content h2 { color: #6c5ce7; font-size: 1.8em; margin-bottom: 15px; }
        .lock-content p { color: #636e72; font-size: 1.1em; margin-bottom: 20px; }
        .device-id-box { background: #f8f9fa; border: 2px dashed #6c5ce7; border-radius: 10px; padding: 15px; margin: 20px 0; }
        .device-id-box label { display: block; font-size: 0.9em; color: #636e72; margin-bottom: 5px; }
        .device-id-box .id-value { font-family: 'Courier New', monospace; font-size: 0.95em; color: #2d3436; word-break: break-all; font-weight: bold; }
        .token-input { width: 100%; padding: 15px; font-size: 1em; border: 2px solid #dfe6e9; border-radius: 10px; margin: 15px 0; font-family: 'Courier New', monospace; }
        .btn-primary { background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white; border: none; border-radius: 12px; padding: 15px 30px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; }
        .btn-whatsapp { background: #25D366; color: white; border: none; border-radius: 12px; padding: 15px 30px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; text-decoration: none; display: block; }
        .error-message { background: #ff7675; color: white; padding: 12px; border-radius: 8px; margin: 15px 0; display: none; }
        .error-message.show { display: block; }
        .warning-banner { background: #ffeaa7; color: #2d3436; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none; }
        .warning-banner.show { display: block; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); overflow: hidden; display: none; }
        .container.unlocked { display: block; }
        header { background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white; padding: 40px 25px; text-align: center; }
        header h1 { font-size: 2.3em; margin-bottom: 10px; }
        .greeting { background: #fff5f5; padding: 30px; text-align: center; }
        .greeting img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px; }
    </style>
</head>
<body>
    <div id="lockModal" class="lock-modal">
        <div class="lock-content">
            <div class="lock-logo">üîí</div>
            <h2>Cora√ß√£o Peludinho</h2>
            <p>Este aplicativo requer uma licen√ßa ativa para funcionar.</p>
            <div class="device-id-box">
                <label>ID do seu dispositivo:</label>
                <div class="id-value" id="deviceId"></div>
                <p style="font-size: 0.85em; color: #636e72; margin-top: 10px;">Envie este ID para o MCI para obter seu c√≥digo de ativa√ß√£o</p>
            </div>
            <input type="text" id="tokenInput" class="token-input" placeholder="Cole seu c√≥digo de ativa√ß√£o aqui">
            <button class="btn-primary" onclick="activateLicense()">üîì Ativar Licen√ßa</button>
            <div id="errorMessage" class="error-message"></div>
            <a href="https://wa.me/5491130820725?text=Ol%C3%A1%2C%20preciso%20ativar%20minha%20licen%C3%A7a%20do%20Cora%C3%A7%C3%A3o%20Peludinho.%20Meu%20ID%20%C3%A9%3A%20" id="whatsappLink" class="btn-whatsapp" target="_blank">üí¨ Contatar MCI pelo WhatsApp</a>
        </div>
    </div>
    <div id="warningBanner" class="warning-banner"><strong>‚ö†Ô∏è Sua assinatura vence em breve</strong><p id="warningText"></p></div>
    <div id="appContainer" class="container">
        <header><h1>üêæ Cora√ß√£o Peludinho</h1><p>Apoio no luto pela perda do seu pet</p></header>
        <div class="greeting"><img src="clara-lavanda.jpg" alt="Clara"><h2>Estou aqui por voc√™</h2></div>
    </div>
    <script>
        function generateDeviceId() {
            let d = localStorage.getItem('deviceId_pets_pt');
            if (!d) { d = 'PET-PT-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9); localStorage.setItem('deviceId_pets_pt', d); }
            return d;
        }
        function displayDeviceId() {
            const d = generateDeviceId();
            document.getElementById('deviceId').textContent = d;
            const w = document.getElementById('whatsappLink');
            w.setAttribute('href', w.getAttribute('href') + d);
        }
        function validateLicense() {
            const l = localStorage.getItem('licenseToken_pets_pt');
            if (!l) return { valid: false, reason: 'no_license' };
            try {
                const license = JSON.parse(atob(l));
                const d = generateDeviceId();
                if (license.deviceId !== d) return { valid: false, reason: 'wrong_device' };
                const days = Math.ceil((new Date(license.expiry) - new Date()) / 86400000);
                if (days < -5) return { valid: false, reason: 'expired' };
                if (days < 0) return { valid: true, grace: true, daysLeft: 5 + days };
                if (days <= 5) return { valid: true, warning: true, daysLeft: days };
                return { valid: true };
            } catch(e) { return { valid: false, reason: 'invalid_token' }; }
        }
        function activateLicense() {
            const token = document.getElementById('tokenInput').value.trim();
            const err = document.getElementById('errorMessage');
            if (!token) { err.textContent = 'Por favor, insira um c√≥digo de ativa√ß√£o'; err.classList.add('show'); return; }
            try {
                const license = JSON.parse(atob(token));
                const d = generateDeviceId();
                if (license.deviceId !== d) { err.textContent = 'Este c√≥digo n√£o √© v√°lido para este dispositivo'; err.classList.add('show'); return; }
                if (new Date(license.expiry) < new Date()) { err.textContent = 'Este c√≥digo expirou. Entre em contato com o MCI para renovar'; err.classList.add('show'); return; }
                Object.keys(localStorage).forEach(k => { if (k.includes('pets_pt')) localStorage.removeItem(k); });
                localStorage.setItem('deviceId_pets_pt', d);
                localStorage.setItem('licenseToken_pets_pt', token);
                err.classList.remove('show');
                unlockApp();
            } catch(e) { err.textContent = 'C√≥digo inv√°lido'; err.classList.add('show'); }
        }
        function unlockApp() {
            document.getElementById('lockModal').classList.add('hidden');
            document.getElementById('appContainer').classList.add('unlocked');
            const v = validateLicense();
            if (v.warning || v.grace) {
                document.getElementById('warningText').textContent = v.grace ? `Sua assinatura expirou. Voc√™ tem ${v.daysLeft} dias de per√≠odo de car√™ncia. Renove por $9.99 USD/m√™s` : `Sua assinatura vence em ${v.daysLeft} dias. Renove por $9.99 USD/m√™s`;
                document.getElementById('warningBanner').classList.add('show');
            }
        }
        window.onload = function() {
            displayDeviceId();
            const v = validateLicense();
            if (v.valid) { unlockApp(); }
            else {
                const err = document.getElementById('errorMessage');
                if (v.reason === 'expired') { err.textContent = 'Sua licen√ßa expirou. Entre em contato com o MCI para renovar por $9.99 USD/m√™s'; err.classList.add('show'); }
                else if (v.reason === 'wrong_device') { err.textContent = 'Esta licen√ßa est√° vinculada a outro dispositivo'; err.classList.add('show'); }
            }
        };
    </script>
</body>
</html>
